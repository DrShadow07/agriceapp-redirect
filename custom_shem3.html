<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>D√©cryptage Lien AgriceApp</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
  <h2>üîì D√©chiffrement des param√®tres</h2>
  <div id="output" style="white-space: pre-wrap; background:#f0f0f0; padding:10px;"></div>

  <script>
    const SECRET_KEY = "MaCleSuperSecrete123"; // üîë m√™me cl√© que dans ton g√©n√©rateur !

    function decryptParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const encrypted = urlParams.get("data");

      if (!encrypted) {
        document.getElementById("output").textContent = "‚ùå Aucun param√®tre 'data' trouv√© dans l'URL.";
        return;
      }

      try {
        // D√©chiffrer avec la m√™me cl√©
        const bytes = CryptoJS.AES.decrypt(encrypted, SECRET_KEY);
        const decryptedText = bytes.toString(CryptoJS.enc.Utf8);

        if (!decryptedText) {
          document.getElementById("output").textContent = "‚ö†Ô∏è Erreur : impossible de d√©chiffrer (cl√© incorrecte ?).";
          return;
        }

        // Convertir en JSON
        const data = JSON.parse(decryptedText);

        document.getElementById("output").textContent =
          "‚úÖ Param√®tres d√©chiffr√©s :\n" + JSON.stringify(data, null, 2);

        // Ensuite, rediriger vers l'app si tu veux :
        // let appUrl = "dimsapp://open?tel=" + encodeURIComponent(data.tel) +
        //              "&uri=" + encodeURIComponent(data.uri) +
        //              "&email=" + encodeURIComponent(data.email) +
        //              "&mdp=" + encodeURIComponent(data.mdp);
        // window.location.href = appUrl;

      } catch (e) {
        document.getElementById("output").textContent = "‚ùå Exception : " + e.message;
      }
    }

    decryptParams();
  </script>
</body>
</html>
